<?xml version="1.0" encoding="UTF-8"?>
<!-- Builds the AnyWikiDraw cookbook for PmWiki. -->
<project name="build-pmwikidraw" default="all" basedir=".">
    <target name="init">
        <property name="version" value="0.13.3"/>
        <property name="lib" value="lib"/>
        <property name="src.main" value="src/main/java"/>
        <property name="src.jhotdraw" value="src/jhotdraw7/java"/>
        <property name="src.pmwiki" value="src/main/wiki/pmwiki/cookbook/AnyWikiDraw"/>
        <property name="build" value="build/classes"/>
        <property name="dist" value="dist/AnyWikiDraw ${version}/anywikidraw"/>
        <property name="dist.extensions" value="${dist}/pmwiki/cookbook/AnyWikiDraw"/>
        <property name="author" value="Werner Randelshofer, AnyWikiDraw.org"/>
        <property name="keystore.file" value="../../../../_Keystore/JavaKeystore"/>
        <property name="keystore.alias" value="werner"/>
        <property name="keystore.storepass" value="werner"/>
        <property name="debug" value="false"/>
    </target>
    <target name="clean" depends="init">
        <delete dir="${build}" />
    </target>
    <target name="applet.compile" depends="init,clean">
        <mkdir dir="${build}"/>
        <javac
                destdir="${build}"
                srcdir="${src.main}:${src.jhotdraw}"
                debug="${debug}"
                source="1.5"
                encoding="UTF-8"
                optimize="true"
         >
            <classpath path="${lib}/java_30.zip"/>
            <classpath path="${lib}/swing-layout.jar"/>
            <include name="org/anywikidraw/pmwiki/PmWikiDrawingApplet.java"/> 
            <include name="net/n3/nanoxml/StdXMLParser.java" />
        </javac>
        <copy todir="${build}/org/anywikidraw/any">
            <fileset dir="${src.main}">
                <include name="org/anywikidraw/any/*.properties"/>
                <include name="org/anywikidraw/any/**/*.png"/>
            </fileset>
        </copy>
        <copy todir="${build}">
            <fileset dir="${src.jhotdraw}" >
                <include name="org/jhotdraw/app/action/images/editCut.png"/>
                <include name="org/jhotdraw/app/action/images/editCopy.png"/>
                <include name="org/jhotdraw/app/action/images/editPaste.png"/>
                <include name="org/jhotdraw/app/action/images/spacerIcon.png"/>
                <include name="org/jhotdraw/app/Label*.properties"/>

                <include name="org/jhotdraw/gui/Label*.properties"/>

                <include name="org/jhotdraw/draw/Label*.properties"/>
                <include name="org/jhotdraw/draw/action/images/*.png"/>

                <include name="org/jhotdraw/samples/svg/action/images/*.png"/>
                <include name="org/jhotdraw/samples/svg/Label*.properties"/>

                <include name="org/jhotdraw/undo/images/*.png"/>
                <include name="org/jhotdraw/undo/Label*.properties"/>
            </fileset>
        </copy>
        <echo file="${build}/org/anywikidraw/any/version.txt"
            message="${version}"/>
    </target>
    <target name="applet.jar" depends="init,applet.compile">
        <!--delete dir="${dist}" /-->
        <mkdir dir="${dist}"/>
        <copy todir="${dist}">
            <fileset dir=".">
                <include name="*.html"/>
            </fileset>
        </copy>
        <delete dir="${dist.extensions}"/>
        <mkdir dir="${dist.extensions}"/>
        <jar destfile="${dist.extensions}/AnyWikiDrawForPmWiki.jar" basedir="${build}"
        index="true" compress="true">
            <manifest>
                <attribute name="Built-By" value="${author}"/>
                <attribute name="Main-Class" value="org.anywikidraw.pmwiki.PmWikiDrawingApplet"/>
            </manifest>
        </jar>
        <exec executable="pack200">
            <arg value="${dist.extensions}/AnyWikiDrawForPmWiki.jar.pack.gz"/>
            <arg value="${dist.extensions}/AnyWikiDrawForPmWiki.jar"/>
        </exec>
        <copy todir="${dist.extensions}">
            <fileset dir="${src.pmwiki}"/>
        </copy>
    </target>
    <target name="applet.signedjar" depends="applet.jar">
        <exec executable="pack200">
            <arg value="-r"/>
            <arg value="${dist.extensions}/AnyWikiDrawForPmWiki.jar"/>
        </exec>
        <signjar alias="${keystore.alias}" storepass="${keystore.storepass}"
                keystore="${keystore.file}" 
                jar="${dist.extensions}/AnyWikiDrawForPmWiki.jar"
                
                >
        </signjar>        
        <exec executable="pack200">
            <arg value="${dist.extensions}/AnyWikiDrawForPmWiki.jar.pack.gz"/>
            <arg value="${dist.extensions}/AnyWikiDrawForPmWiki.jar"/>
        </exec>
        <copy todir="${dist.extensions}">
            <fileset dir="${src.pmwiki}"/>
        </copy>
    </target>
    <target name="applet.run-compiled" depends="init">
        <java classname="org.anywikidraw.pmwiki.PmWikiDrawingApplet">
            <classpath>
                <pathelement location="${build}"/>
            <pathelement location="${lib}/java_30.zip"/>
            <pathelement location="${lib}/swing-layout.jar"/>
            </classpath>
        </java>
    </target>
    <target name="applet.run-jar" depends="init">
        <java fork="true" jar="${dist.extensions}/AnyWikiDrawForPmWiki.jar">
        </java>
    </target>
    <target name="applet.appletviewer" depends="init">
        <exec executable="appletviewer">
        <arg value="${build}/pmwikidraw.html"/>
        </exec>
    </target>
    <target name="dist" depends="clean,applet.signedjar">
    </target>
</project>
